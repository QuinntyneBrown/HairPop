<div class="user-detail">
  <div class="page-header">
    <div>
      <h1 class="page-title">{{ isNew() ? 'New User' : 'User profile' }}</h1>
      <div class="muted">Entity fields: UserProfile, UserPreference, FavoriteBraider</div>
    </div>
    <div class="actions">
      <a class="btn btn--stroked" routerLink="/users">
        <span class="material-icons-outlined">arrow_back</span>
        Back
      </a>
      @if (!isNew()) {
        <button class="btn btn--warn" (click)="delete()">
          <span class="material-icons-outlined">delete</span>
          Delete
        </button>
      }
      <button class="btn btn--primary" (click)="save()">
        <span class="material-icons-outlined">save</span>
        Save
      </button>
    </div>
  </div>

  <div class="grid grid--2">
    <div class="card">
      <div class="card__header">
        <div>
          <div class="card__title">Profile</div>
          <div class="card__subtitle">Email, name, phone, location, image</div>
        </div>
      </div>
      <div class="card__content">
        <div class="form-grid">
          <div class="form-field">
            <label class="form-field__label">Email</label>
            <input class="form-field__input" [value]="email()" (input)="email.set($any($event.target).value)">
          </div>
          <div class="form-field">
            <label class="form-field__label">Display name</label>
            <input class="form-field__input" [value]="displayName()" (input)="displayName.set($any($event.target).value)">
          </div>
          <div class="form-field">
            <label class="form-field__label">First name</label>
            <input class="form-field__input" [value]="firstName()" (input)="firstName.set($any($event.target).value)">
          </div>
          <div class="form-field">
            <label class="form-field__label">Last name</label>
            <input class="form-field__input" [value]="lastName()" (input)="lastName.set($any($event.target).value)">
          </div>
          <div class="form-field">
            <label class="form-field__label">Phone number</label>
            <input class="form-field__input" [value]="phoneNumber()" (input)="phoneNumber.set($any($event.target).value)">
          </div>
          <div class="form-field">
            <label class="form-field__label">Location</label>
            <input class="form-field__input" [value]="location()" (input)="location.set($any($event.target).value)">
          </div>
          <div class="form-field full-width">
            <label class="form-field__label">Profile image URL</label>
            <input class="form-field__input" [value]="profileImageUrl()" (input)="profileImageUrl.set($any($event.target).value)">
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card__header">
        <div>
          <div class="card__title">Preferences</div>
          <div class="card__subtitle">Manage key/value preferences</div>
        </div>
      </div>
      <div class="card__content">
        <div class="actions" style="margin-bottom: var(--spacing-md)">
          <button class="btn btn--primary" (click)="addPreference()">
            <span class="material-icons-outlined">add</span>
            Add preference
          </button>
        </div>
        <table class="table">
          <thead>
            <tr>
              <th>Key</th>
              <th>Value</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            @for (pref of preferences(); track pref.id) {
              <tr>
                <td>{{ pref.key }}</td>
                <td class="muted">{{ pref.value }}</td>
                <td class="actions">
                  <button class="btn btn--stroked" (click)="removePreference(pref.id)">
                    <span class="material-icons-outlined">delete</span>
                  </button>
                </td>
              </tr>
            }
            @empty {
              <tr>
                <td colspan="3" class="muted" style="text-align: center; padding: var(--spacing-lg);">No preferences</td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </div>

    <div class="card full-width">
      <div class="card__header">
        <div>
          <div class="card__title">Favorite braiders</div>
          <div class="card__subtitle">Manage FavoriteBraider links</div>
        </div>
      </div>
      <div class="card__content">
        <div class="actions" style="margin-bottom: var(--spacing-md)">
          <button class="btn btn--primary" (click)="addFavorite()">
            <span class="material-icons-outlined">add</span>
            Add favorite
          </button>
        </div>
        <table class="table">
          <thead>
            <tr>
              <th>Braider</th>
              <th>Added</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            @for (fav of favorites(); track fav.id) {
              <tr>
                <td>{{ fav.braiderName }}</td>
                <td class="muted">{{ fav.addedAt }}</td>
                <td class="actions">
                  <button class="btn btn--stroked" (click)="removeFavorite(fav.id)">
                    <span class="material-icons-outlined">remove_circle</span>
                    Remove
                  </button>
                </td>
              </tr>
            }
            @empty {
              <tr>
                <td colspan="3" class="muted" style="text-align: center; padding: var(--spacing-lg);">No favorites</td>
              </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
